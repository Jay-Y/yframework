<!-- widget grid -->
<section id="widget-grid" class="">
    <!-- row -->
    <div class="row">
        <!-- NEW WIDGET START -->
        <article class="col-xs-12 col-sm-12 col-md-12 col-lg-12">

            <!-- Widget ID (each widget will need unique ID)-->
            <div class="jarviswidget jarviswidget-color-blueDark" id="wid-id-1" data-widget-editbutton="false">
                <!-- widget options:
				usage: <div class="jarviswidget" id="wid-id-0" data-widget-editbutton="false">
				data-widget-colorbutton="false"
				data-widget-editbutton="false"
				data-widget-togglebutton="false"
				data-widget-deletebutton="false"
				data-widget-fullscreenbutton="false"
				data-widget-custombutton="false"
				data-widget-collapsed="true"
				data-widget-sortable="false"
				-->
                <header>
                    <span class="widget-icon"> <i class="fa fa-table"></i> </span>
                    <h2>列表</h2>
                </header>
                <!-- widget div-->
                <div>
                    <!-- widget content -->
                    <div class="widget-body no-padding">
                        <table id="datatable" class="table table-striped table-bordered" width="100%">
                        </table>
                    </div>
                    <!-- end widget content -->
                </div>
                <!-- end widget div -->
            </div>
            <!-- end widget -->
        </article>
        <!-- WIDGET END -->
    </div>
    <!-- end row -->
</section>
<!-- end widget grid -->
<script type="text/javascript">
    var api = _HOST + 'mgt/dicts';
    var redirect = 'module/system/dict-form.html';

    var otable;

    /* DO NOT REMOVE : GLOBAL FUNCTIONS!
     *
     * pageSetUp(); WILL CALL THE FOLLOWING FUNCTIONS
     *
     * // activate tooltips
     * $("[rel=tooltip]").tooltip();
     *
     * // activate popovers
     * $("[rel=popover]").popover();
     *
     * // activate popovers with hover states
     * $("[rel=popover-hover]").popover({ trigger: "hover" });
     *
     * // activate inline charts
     * runAllCharts();
     *
     * // setup widgets
     * setup_widgets_desktop();
     *
     * // run form elements
     * runAllForms();
     *
     ********************************
     *
     * pageSetUp() is needed whenever you load a page.
     * It initializes and checks for all basic elements of the page
     * and makes rendering easier.
     *
     */
    pageSetUp();

    /*
     * ALL PAGE RELATED SCRIPTS CAN GO BELOW HERE
     * eg alert("my home function");
     *
     * var pagefunction = function() {
     *   ...
     * }
     * loadScript("js/plugin/_PLUGIN_NAME_.js", pagefunction);
     *
     */

    // PAGE RELATED SCRIPTS

    function onInit() {
        otable = mgt.datatable.onInit(
            $('#datatable'),
            {
                hasToolbar: true,
                hasHead: true,
                hasCondition: true,
                url: api,
                columns: [
                    {
                        "class": "hidden",
                        "sTitle": "ID",
                        "sName": "id",
                        "mData": "id"
                    },
                    {
                        "sTitle": "标签名",
                        "sName": "label",
                        "mData": "label",
                        "sDefault": true
                    },
                    {
                        "sTitle": "值",
                        "sName": "value",
                        "mData": "value"
                    },
                    {
                        "sTitle": "类型值",
                        "sName": "type",
                        "mData": "type"
                    },
                    {
                        "sTitle": "类型描述",
                        "sName": "description",
                        "mData": "description"
                    },
                    {
                        "sTitle": "<i class='fa fa-fw fa-briefcase text-muted hidden-md hidden-sm hidden-xs'></i>操作",
                        "class": "text-align-center",
                        "orderable": false,
                        "searchable": false,
                        "mRender": function (cell, b, row, d) {
                            var operation = '<ul class="demo-btns">';
                            operation += '<li><a href="javascript:void(0);" onclick="onEdit(this, \'' + row.id + '\');" class="btn txt-color-blue" data-toggle="modal" data-target="#remoteModal"><i class="fa fa-lg fa-edit" title="修改"></i></a></li>';
                            operation += '<li>&nbsp;<a href="javascript:void(0);" onclick="onDelete(this, \'' + row.id + '\');" class="btn txt-color-red"><i class="fa fa-trash-o fa-lg" title="删除"></i></a></li>';
                            operation += '</ul>';
                            return operation;
                        },
                        "width": 100
                    }
                ]
            }
        );

        var operation = '<ul class="demo-btns">';
        operation += '<li><a href="javascript:void(0);" onclick="onEdit(this);" class="btn btn-sm bg-color-green txt-color-white" data-toggle="modal" data-target="#remoteModal"><i class="fa fa-lg fa-plus" title="新增"></i>新增</a></li>';
        operation += '</ul>';
        //Custom toolbar
        $(".custom-toolbar").html(operation);

        // Apply the filter
//        $(".custom-condition").on('keyup change', function () {
//            otable.draw();
//        });
        /* END COLUMN FILTER */
        mgt.form.table.set(api, otable);
    }

    function onEdit(obj, id) {
        if (id) {
            obj.setAttribute('data-id', id);
        }
        obj.href = redirect;
    }

    function onDelete(obj, id) {
        dialog.error("确认要删除?", "删除数据", function () {
            mgt.service.delete(api, id,
                function (res) {
                    $(obj).parents("tr").remove();
                    otable.draw();
                }, function (res) {
                    dialog.error(res.description || res.message || '系统错误');
                });
        });
    }
    // load related plugins

    loadScript(_LIB_PATH + "datatables/jquery.dataTables.min.js", function () {
        loadScript(_LIB_PATH + "datatables/dataTables.colVis.min.js", function () {
            loadScript(_LIB_PATH + "datatables/dataTables.tableTools.min.js", function () {
                loadScript(_LIB_PATH + "datatables/dataTables.bootstrap.min.js", function () {
                    loadScript(_LIB_PATH + "datatable-responsive/datatables.responsive.min.js", function () {
                        loadScript(_BASE_PATH + "mgt.datatable.js", onInit)
                    });
                });
            });
        });
    });


</script>