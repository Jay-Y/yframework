<!-- widget grid -->
<section id="widget-grid" class="">
    <!-- row -->
    <div class="row">
        <!-- NEW WIDGET START -->
        <article class="col-xs-12 col-sm-12 col-md-12 col-lg-12">

            <!-- Widget ID (each widget will need unique ID)-->
            <div class="jarviswidget jarviswidget-color-blueDark" id="wid-id-1" data-widget-editbutton="false">
                <header>
                    <span class="widget-icon"> <i class="fa fa-table"></i> </span>
                    <h2>列表</h2>
                </header>
                <!-- widget div-->
                <div>
                    <!-- widget edit box -->
                    <div class="jarviswidget-editbox">
                        <!-- This area used as dropdown edit box -->
                    </div>
                    <!-- end widget edit box -->
                    <!-- widget content -->
                    <div class="widget-body no-padding">
                        <table id="datatable" class="treetable table table-striped table-bordered" width="100%">
                        </table>
                    </div>
                    <!-- end widget content -->
                </div>
                <!-- end widget div -->
            </div>
            <!-- end widget -->
        </article>
        <!-- WIDGET END -->
    </div>
    <!-- end row -->
</section>
<!-- end widget grid -->
<script type="text/javascript">
    var api = _HOST + 'mgt/menus';
    var redirect = 'module/system/menu-form.html';

    var otable;

    pageSetUp();

    function onInit() {
        otable = mgt.datatable.tree.onInit(
            $('#datatable'),
            {
                hasToolbar: false,
                hasHead: true,
                hasCondition: false,
                url: api + "/normal",
                columns: [
                    {
                        "class": "hidden",
                        "sTitle": "ID",
                        "sName": "id",
                        "mData": "id"
                    },
                    {
                        "sTitle": "菜单名",
                        "sName": "name",
                        "mData": "name"
                    },
                    {
                        "class": "hidden-xs",
                        "cClass": "hidden-xs",
                        "sTitle": "图标",
                        "sName": "icon",
                        "mData": "icon",
                        "mRender": function (cell, b, row, d) {
                            return '<i class="' + cell + '"></i>';
                        }
                    },
                    {
                        "sTitle": "地址",
                        "sName": "href",
                        "mData": "href"
                    },
                    {
                        "sTitle": "排序",
                        "sName": "sort",
                        "mData": "sort"
                    },
                    {
                        "sTitle": "是否显示",
                        "sName": "show",
                        "mData": "show"
                    },
                    {
                        "class": "hidden-xs",
                        "cClass": "hidden-xs",
                        "sTitle": "权限",
                        "sName": "permission",
                        "mData": "permission"
                    },
                    {
                        "sTitle": "<i class='fa fa-fw fa-briefcase text-muted hidden-md hidden-sm hidden-xs'></i>操作",
                        "class": "text-align-center",
                        "orderable": false,
                        "searchable": false,
                        "mRender": function (cell, b, row, d) {
                            var operation = '<ul class="demo-btns">';
                            operation += '<li><a href="javascript:void(0);" onclick="onEdit(this, \'' + row.id + '\');" class="btn txt-color-blue" data-toggle="modal" data-target="#remoteModal"><i class="fa fa-lg fa-edit" title="修改"></i></a></li>';
                            if ('1' != row.id) {
                                operation += '<li>&nbsp;<a href="javascript:void(0);" onclick="onDelete(this, \'' + row.id + '\');" class="btn txt-color-red"><i class="fa fa-trash-o fa-lg" title="删除"></i></a></li>';
                            }
                            operation += '</ul>';
                            return operation;
                        },
                        "width": 100
                    }
                ]
            },
            []
        );

        var operation = '<ul class="demo-btns">';
        operation += '<li><a href="javascript:void(0);" onclick="onEdit(this);" class="btn btn-sm bg-color-green txt-color-white" data-toggle="modal" data-target="#remoteModal"><i class="fa fa-plus fa-lg" title="新增"></i></a></li>';
        operation += '<li>&nbsp;<a href="javascript:void(0);" onclick="onSearch();" class="btn btn-sm bg-color-blue txt-color-white"><i class="fa fa-search fa-lg" title="搜索""></i></a></li>';
        operation += '</ul>';
        //Custom toolbar
        $(".custom-toolbar").html(operation);

        // Apply the filter
//        $(".custom-condition").on('keyup change', function () {
//            otable.draw();
//        });
        /* END COLUMN FILTER */
        mgt.form.table.set(api, otable);
    }
    ;

    function onSearch() {
        otable.draw();
    }
    // load related plugins

    function onEdit(obj, id) {
        obj.setAttribute('data-id', id);
        obj.href = redirect;
    }

    function onDelete(obj, id) {
        dialog.error("确认要删除?", "删除数据", function () {
            mgt.service.delete(api, id,
                function (res) {
                    yutil.storage.remove(_KEY_MGT_MENUS + '_root');
                    yutil.storage.remove(_KEY_MGT_MENUS + '_account');
                    yutil.storage.remove(_KEY_MGT_MENUS);
                    $(obj).parents("tr").remove();
                    otable.draw();
                }, function (res) {
                    dialog.error(res.description || res.message || '系统错误');
                });
        });
    }

    loadScript(_LIB_PATH + "datatables/jquery.dataTables.min.js", function () {
        loadScript(_LIB_PATH + "datatables/dataTables.colVis.min.js", function () {
            loadScript(_LIB_PATH + "datatables/dataTables.tableTools.min.js", function () {
                loadScript(_LIB_PATH + "datatables/dataTables.bootstrap.min.js", function () {
                    loadScript(_LIB_PATH + "datatable-responsive/datatables.responsive.min.js", function () {
                        loadScript(_BASE_PATH + "mgt.datatable.js", function () {
                            loadScript(_BASE_PATH + "mgt.datatable.tree.js", onInit);
                        });
                    });
                });
            });
        });
    });


</script>