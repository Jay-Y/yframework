<style>
    .button {
        display: inline-block;
        zoom: 1; /* zoom and *display = ie7 hack for display:inline-block */
        *display: inline;
        vertical-align: baseline;
        margin: 3px;
        outline: none;
        cursor: pointer;
        text-align: center;
        text-decoration: none;
        font: 14px/100% Arial, Helvetica, sans-serif;
        padding: 3px;
        text-shadow: 0 1px 1px rgba(0, 0, 0, .3);
        -webkit-border-radius: .5em;
        -moz-border-radius: .5em;
        border-radius: .5em;
        -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, .2);
        -moz-box-shadow: 0 1px 2px rgba(0, 0, 0, .2);
        box-shadow: 0 1px 2px rgba(0, 0, 0, .2);
    }

    .medium {
        font-size: 12px;
        padding: 3px;
    }

    .orange {
        color: #fef4e9;
        border: solid 1px #da7c0c;
        background: #f78d1d;
        background: -webkit-gradient(linear, left top, left bottom, from(#faa51a), to(#f47a20));
        background: -moz-linear-gradient(top, #faa51a, #f47a20);
        filter: progid:DXImageTransform.Microsoft.gradient(startColorstr='#faa51a', endColorstr='#f47a20');
    }
</style>
<!-- widget grid -->
<section id="widget-grid" class="">
    <!-- row -->
    <div class="row">
        <!-- NEW WIDGET START -->
        <article class="col-xs-12 col-sm-12 col-md-12 col-lg-12">

            <!-- Widget ID (each widget will need unique ID)-->
            <div class="jarviswidget jarviswidget-color-blueDark" id="wid-id-1" data-widget-editbutton="false">
                <!-- widget options:
				usage: <div class="jarviswidget" id="wid-id-0" data-widget-editbutton="false">
				data-widget-colorbutton="false"
				data-widget-editbutton="false"
				data-widget-togglebutton="false"
				data-widget-deletebutton="false"
				data-widget-fullscreenbutton="false"
				data-widget-custombutton="false"
				data-widget-collapsed="true"
				data-widget-sortable="false"
				-->
                <header>
                    <span class="widget-icon"> <i class="fa fa-table"></i> </span>
                    <h2>列表</h2>
                </header>
                <!-- widget div-->
                <div>
                    <!-- widget edit box -->
                    <div class="jarviswidget-editbox">
                        <!-- This area used as dropdown edit box -->
                    </div>
                    <!-- end widget edit box -->
                    <!-- widget content -->
                    <div class="widget-body no-padding">
                        <table id="datatable" class="table table-striped table-bordered" width="100%">
                        </table>
                    </div>
                    <!-- end widget content -->
                </div>
                <!-- end widget div -->
            </div>
            <!-- end widget -->
        </article>
        <!-- WIDGET END -->
    </div>
    <!-- end row -->
</section>
<!-- end widget grid -->
<script type="text/javascript">
    var api = _HOST + 'mgt/users';
    var redirect = 'module/system/user-form.html';

    var otable;

    pageSetUp();

    function onInit() {
        var roles = yutil.storage.get(_KEY_MGT_ROLES);
        var roleMap = {};
        roles = roles ? JSON.parse(roles) : [];
        roles.forEach(function (r) {
            roleMap[r.id] = r;
        });
        roles = roleMap;
        otable = mgt.datatable.onInit(
            $('#datatable'),
            {
                hasHead: true,
                hasCondition: true,
                url: api,
                columns: [
                    {
                        "class": "hidden",
                        "sTitle": "ID",
                        "sName": "id",
                        "mData": "id"
                    },
                    {
                        "class": "hidden-xs",
                        "cClass": "hidden-xs",
                        "sTitle": "头像",
                        "sName": "imageUrl",
                        "mData": "imageUrl",
                        "orderable": false,
                        "searchable": false,
                        "mRender": function (cell, b, row, d) {
                            if (yutil.validator.isEmpty(cell)) {
                                return '图片不存在';
                            }
                            else {
                                return '<img width="60px" height="73px" alt="图片未找到" src="' + cell + '"/>';
                            }
                        }
                    },
                    {
                        "sTitle": "登录名",
                        "sName": "login",
                        "mData": "login",
                        "sDefault": true
                    },
                    {
                        "class": "hidden-xs",
                        "cClass": "hidden-xs",
                        "sTitle": "姓氏",
                        "sName": "firstName",
                        "mData": "firstName"
                    },
                    {
                        "class": "hidden-xs",
                        "cClass": "hidden-xs",
                        "sTitle": "名字",
                        "sName": "lastName",
                        "mData": "lastName"
                    },
                    {
                        "class": "hidden-xs",
                        "cClass": "hidden-xs",
                        "sTitle": "邮箱",
                        "sName": "email",
                        "mData": "email"
                    },
                    {
                        "sTitle": "角色",
                        "sName": "authorities",
                        "mData": "authorities",
                        "orderable": false,
                        "searchable": false,
                        "mRender": function (cell, b, row, d) {
                            var s = "";
                            for (var i in cell) {
                                var role = roles[cell[i]];
                                s += '<span class="button orange medium">' + (role && role.name ? role.name : '未知') + '</span>';
                            }
                            return s;
                        }
                    },
                    {
                        "sTitle": "<i class='fa fa-fw fa-briefcase text-muted hidden-md hidden-sm hidden-xs'></i>操作",
                        "class": "text-align-center",
                        "orderable": false,
                        "searchable": false,
                        "mRender": function (cell, b, row, d) {
                            var operation = '<ul class="demo-btns">';
                            operation += '<li><a href="javascript:void(0);" onclick="onEdit(this, \'' + row.id + '\');" class="btn txt-color-blue" data-toggle="modal" data-target="#remoteModal"><i class="fa fa-lg fa-edit" title="修改"></i></a></li>';
                            operation += '<li>&nbsp;<a href="javascript:void(0);" onclick="onDelete(this, \'' + row.id + '\');" class="btn txt-color-red"><i class="fa fa-trash-o fa-lg" title="删除"></i></a></li>';
                            operation += '</ul>';
                            return operation;
                        },
                        "width": 100
                    }
                ]
            }
        );

        var operation = '<ul class="demo-btns">';
        operation += '<li><a href="javascript:void(0);" onclick="onEdit(this);" class="btn btn-sm bg-color-green txt-color-white" data-toggle="modal" data-target="#remoteModal"><i class="fa fa-plus fa-lg" title="新增"></i>新增</a></li>';
        operation += '</ul>';
        //Custom toolbar
        $(".custom-toolbar").html(operation);

        // Apply the filter
//        $(".custom-condition").on('keyup change', function () {
//            otable.draw();
//        });
        /* END COLUMN FILTER */
        mgt.form.table.set(api, otable);
    }
    ;

    function onSearch() {
        otable.draw();
    }
    // load related plugins

    function onEdit(obj, id) {
        obj.setAttribute('data-id', id);
        obj.href = redirect;
    }

    function onDelete(obj, id) {
        dialog.error("确认要删除?", "删除数据", function () {
            mgt.service.delete(api, id,
                function (res) {
                    $(obj).parents("tr").remove();
                    otable.draw();
                }, function (res) {
                    dialog.error(res.description || res.message || '系统错误');
                });
        });
    }

    loadScript(_LIB_PATH + "datatables/jquery.dataTables.min.js", function () {
        loadScript(_LIB_PATH + "datatables/dataTables.colVis.min.js", function () {
            loadScript(_LIB_PATH + "datatables/dataTables.tableTools.min.js", function () {
                loadScript(_LIB_PATH + "datatables/dataTables.bootstrap.min.js", function () {
                    loadScript(_LIB_PATH + "datatable-responsive/datatables.responsive.min.js", function () {
                        loadScript(_BASE_PATH + "mgt.datatable.js", function () {
                            mgt.provider.queryRoles(onInit);
                        });
                    });
                });
            });
        });
    });


</script>